swagger: "2.0"
info:
  title: Biblia AI Chat API
  description: An AI Chat API to interact with Bible characters.
  version: "1.0"
basePath: /api/v1.0
schemes:
  - http
tags:
  - name: Auth
    description: User Authentication
  - name: Characters
    description: Chat with characters

securityDefinitions:
  Bearer:
    type: apiKey
    name: Authorization
    in: header
    description: "JWT Authorization header using the Bearer scheme. Example: 'Bearer {token}'"

security:
  - Bearer: []

paths:
  # Authentication and User Management
  /auth/register:
    post:
      tags:
        - Auth
      summary: Register a new user
      parameters:
        - in: body
          name: user
          description: The user to register
          required: true
          schema:
            $ref: "#/definitions/User"
      responses:
        201:
          description: User registered successfully
        400:
          description: Invalid input
        500:
          description: Internal server error
  /auth/login:
    post:
      tags:
        - Auth
      summary: Login a user
      parameters:
        - in: body
          name: user
          description: The user to login
          required: true
          schema:
            type: object
            properties:
              email:
                type: string
              password:
                type: string
      responses:
        200:
          description: User logged in successfully
          schema:
            type: object
            properties:
              token:
                type: string
        401:
          description: Unauthorized
        500:
          description: Internal server error
        400:
          description: Invalid input
  /auth/me:
    get:
      tags:
        - Auth
      summary: Get current user information
      responses:
        200:
          description: User information retrieved successfully
          schema:
            $ref: "#/definitions/User"
        401:
          description: Unauthorized
        500:
          description: Internal server error
  /auth/reset-password-request:
    post:
      tags:
        - Auth
      summary: Request a password reset
      parameters:
        - in: body
          name: email
          description: The email of the user requesting a password reset
          required: true
          schema:
            type: object
            properties:
              email:
                type: string
      responses:
        200:
          description: Password reset request successful
        400:
          description: Invalid email address
        500:
          description: Internal server error
  /auth/reset-password:
    post:
      tags:
        - Auth
      summary: Reset a user's password
      parameters:
        - in: body
          name: reset_info
          description: The information required to reset the password
          required: true
          schema:
            type: object
            properties:
              token:
                type: string
              new_password:
                type: string
      responses:
        200:
          description: Password reset successful
        400:
          description: Invalid input or token
        500:
          description: Internal server error
  /auth/token/refresh:
    post:
      tags:
        - Auth
      summary: Refresh user authentication token
      parameters:
        - in: body
          name: refresh_token
          description: The refresh token to use
          required: true
          schema:
            type: object
            properties:
              refresh_token:
                type: string
      responses:
        200:
          description: Token refreshed successfully
          schema:
            type: object
            properties:
              token:
                type: string
        401:
          description: Unauthorized
        500:
          description: Internal server error
  # Character route
  /characters/add:
    post:
      tags:
        - Characters
      summary: Add Bible character to chat list
      parameters:
        - in: body
          name: character
          required: true
          type: string
          description: The character to create
          schema:
            $ref: "#/definitions/Character"
      responses:
        201:
          description: Character created successfully
        400:
          description: Invalid input
        500:
          description: Internal server error
  /characters/{character_id}/delete:
    delete:
      tags:
        - Characters
      summary: Delete a character by ID
      parameters:
        - in: path
          name: character_id
          required: true
          type: integer
          description: The ID of the character to delete
      responses:
        204:
          description: Character deleted successfully
        404:
          description: Character not found
        500:
          description: Internal server error
  /characters/search:
    get:
      tags:
        - Characters
      summary: Search for character chat by name
      parameters:
        - in: query
          name: query
          required: true
          type: string
          description: The search term to use
      responses:
        200:
          description: The name of the character
          schema:
            type: array
            items:
              $ref: "#/definitions/Character"
        400:
          description: Invalid search term
        500:
          description: Internal server error
  /characters/{character_id}/chat/clear:
    delete:
      tags:
        - Characters
      summary: Clear character chat with character ID
      parameters:
        - in: body
          name: character_id
          required: true
          type: integer
          description: The ID of the character to delete its chat
      responses:
        204:
          description: Chat deleted successfully
        404:
          description: Character chat not found
        500:
          description: Internal server error
  /characters/{character_id}/chat:
    post:
      tags:
        - Characters
      summary: Chat with character
      parameters:
        - in: path
          name: character_id
          required: true
          type: integer
          description: Chat with character by ID
        - in: body
          name: string
          required: true
          type: string
          description: A message to start chat
          schema:
            properties:
              content:
                type: string
      responses:
      200:
        description: Chat created successfully
      404:
        description: Character not found
      500:
        description: Internal server error
  /characters/{character_id}/chat/{message_id}/delete:
    delete:
      tags:
        - Characters
      summary: Delete a message by ID
      parameters:
        - in: path
          name: character_id
          required: true
          type: integer
          description: The ID of the character
        - in: path
          name: message_id
          required: true
          type: integer
          description: The ID of the message to delete
      responses:
        400:
          description: Invalid input
        200:
          description: Message deleted successfully
        404:
          description: Message not found
        500:
          description: Internal server error
# Define database tables
definitions:
  Character:
    type: object
    required:
      - name
      - description
      - profile_image_url
    properties:
      name:
        type: string
      description:
        type: string
      profile_image_url:
        type: string
  Users:
    type: object
    required:
      - email
      - username
      - password
      - profile_picture_url
      - bio
    properties:
      email:
        type: string
      username:
        type: string
      password:
        type: string
      profile_picture_url:
        type: string
      bio:
        type: string
  Message:
    type: object
    required:
      - sender_id
      - content
      - role
      - character_id
    properties:
      sender_id:
        type: integer
      character_id:
        type: integer
      role:
        type: string
        enum: [user, assistant]
      content:
        type: string